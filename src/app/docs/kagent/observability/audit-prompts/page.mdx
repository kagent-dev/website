---
title: "Audit kagent prompts"
pageOrder: 1
description: "Review and audit prompts used by kagent agents."
---

export const metadata = {
  title: "Audit kagent prompts",
  description: "Review and audit prompts used by kagent agents.",
  author: "kagent.dev"
};

# Audit kagent prompts

Audit all prompts (inputs) and replies (outputs) from your agents. 

Such auditing capability can help security, compliance, and similar teams examine how your users interact with your kagent environment. For example, you might check that users are not sharing personally identifiable information (PII) or other sensitive information when chatting with LLMs, or follow up on past conversations with agents to understand what systems have been interacted with.

## About auditing prompts

Kagent integrates with OpenTelemetry (OTel) systems to emit input/output messages as log events, which you can ingest into your logging or security information and event management (SIEM) systems for auditing purposes. 

Kagent supports logging input/output messages for the following LLM providers:

- OpenAI
- Anthropic

## Before you begin

Make sure that:
- Kagent is installed in your cluster.
- You have access to a logging backend that supports OpenTelemetry's OTLP protocol, such as Grafana Loki, Datadog, Splunk, or other OTLP-compatible systems.

## Install an OpenTelemetry collector

For production environments, use an OpenTelemetry collector as an intermediary between kagent and your logging backend. The collector provides more control over what metadata and content you ship to your logging systems.

Use cases for an intermediate collector include:

- **Production setup with large volume of agentic flow**: A collector can help drop or transform your logs
- **Enriching logs with Kubernetes metadata**: Use the upstream `k8sattributesprocessor`
- **Redacting sensitive information**: Strip sensitive information via `redactionprocessor`

### Step 1: Create the telemetry namespace

```bash
kubectl create namespace telemetry
```

### Step 2: Install the OpenTelemetry collector

Install the OpenTelemetry collector using Helm. This example configures the collector with an OTLP receiver for logs and an OTLP exporter that you can point to your logging backend.

```bash
helm repo add open-telemetry https://open-telemetry.github.io/opentelemetry-helm-charts
helm repo update
```

Create a values file for the OpenTelemetry collector that configures it for auditing kagent prompts:

```bash
cat > otel-collector-audit.yaml <<EOF
mode: deployment

config:
  receivers:
    otlp:
      protocols:
        grpc:
          endpoint: 0.0.0.0:4317
        http:
          endpoint: 0.0.0.0:4318

  processors:
    batch:
      timeout: 10s
      send_batch_size: 1024
    # Optional: Add k8sattributes processor to enrich logs with Kubernetes metadata
    # k8sattributes:
    #   auth_type: serviceAccount
    #   passthrough: false
    #   extract:
    #     metadata:
    #       - k8s.pod.name
    #       - k8s.pod.uid
    #       - k8s.namespace.name
    #       - k8s.node.name
    #       - k8s.pod.start_time
    #   pod_association:
    #     - from: resource_attribute
    #       name: k8s.pod.ip

  exporters:
    otlp/logs:
      endpoint: <your-logging-backend-endpoint>
      tls:
        insecure: false
      # If your backend requires authentication, uncomment and configure:
      # headers:
      #   Authorization: "Bearer <your-token>"

  service:
    pipelines:
      logs:
        receivers: [otlp]
        processors: [batch]
        exporters: [otlp/logs]
EOF
```

Replace `<your-logging-backend-endpoint>` with the endpoint of your logging backend. For example:
- Grafana Loki: `http://loki-gateway.telemetry.svc.cluster.local:80`
- Datadog: `https://api.datadoghq.com`
- A custom OTLP endpoint: `https://your-otel-endpoint.com:4317`

Install the collector:

```bash
helm install opentelemetry-collector-audit open-telemetry/opentelemetry-collector \
  --namespace telemetry \
  --values otel-collector-audit.yaml
```

### Step 3: Verify the collector is running

```bash
kubectl get pods -n telemetry -l app.kubernetes.io/name=opentelemetry-collector
```

Example output:

```
NAME                                          READY   STATUS    RESTARTS   AGE
opentelemetry-collector-audit-xxxxxxxxx-xxxxx   1/1     Running   0          30s
```

## Configure kagent to use the collector

After the OpenTelemetry collector is running, configure kagent to send logs to it.

### Option 1: Upgrade an existing installation

If kagent is already installed, upgrade it to enable logging:

```bash
helm upgrade kagent oci://ghcr.io/kagent-dev/kagent/helm/kagent \
  --namespace kagent \
  --reuse-values \
  --set otel.logging.enabled=true \
  --set otel.logging.exporter.otlp.endpoint=http://opentelemetry-collector-audit.telemetry.svc.cluster.local:4317 \
  --set otel.logging.exporter.otlp.insecure=true \
  --set otel.logging.exporter.otlp.timeout=15
```

### Option 2: Install kagent with logging enabled

If you're installing kagent for the first time, include the logging configuration:

```bash
helm install kagent oci://ghcr.io/kagent-dev/kagent/helm/kagent \
  --namespace kagent \
  --create-namespace \
  --set otel.logging.enabled=true \
  --set otel.logging.exporter.otlp.endpoint=http://opentelemetry-collector-audit.telemetry.svc.cluster.local:4317 \
  --set otel.logging.exporter.otlp.insecure=true \
  --set otel.logging.exporter.otlp.timeout=15
```

> **Note**: If you find the traces emitted by default too verbose, you can disable them. Logging will still work. Set `otel.tracing.enabled=false` in your Helm values.

## Verify the setup

1. Generate some traffic by invoking a kagent agent that uses OpenAI or Anthropic.

2. Check that logs are being collected by the OpenTelemetry collector:

   ```bash
   kubectl -n telemetry logs -l app.kubernetes.io/name=opentelemetry-collector --tail=50 | grep -i "prompt\|input\|output"
   ```

3. Verify that logs are being exported to your logging backend by checking your backend's interface or querying it directly.

## Direct export to logging backend

If you don't need an intermediate collector, you can configure kagent to export logs directly to your OTLP-compatible logging backend:

```bash
helm upgrade kagent oci://ghcr.io/kagent-dev/kagent/helm/kagent \
  --namespace kagent \
  --reuse-values \
  --set otel.logging.enabled=true \
  --set otel.logging.exporter.otlp.endpoint=<your-logging-backend-endpoint> \
  --set otel.logging.exporter.otlp.insecure=false \
  --set otel.logging.exporter.otlp.timeout=15
```

Replace `<your-logging-backend-endpoint>` with your logging backend's OTLP endpoint.

## Cleanup

To remove the OpenTelemetry collector:

```bash
helm uninstall opentelemetry-collector-audit -n telemetry
kubectl delete namespace telemetry
```

To disable logging in kagent:

```bash
helm upgrade kagent oci://ghcr.io/kagent-dev/kagent/helm/kagent \
  --namespace kagent \
  --reuse-values \
  --set otel.logging.enabled=false
```
